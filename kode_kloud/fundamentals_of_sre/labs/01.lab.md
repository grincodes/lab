# Lab 1
Implementing Basic SLI

# Overview
Learning Outcomes of the Lab

In this lab, you will:

-> Understand how to define and measure Service Level Indicators (SLIs) to assess system performance

-> Learn how to calculate uptime percentages and interpret their significance in service reliability

-> Develop foundational skills that will be essential for working with Prometheus and Grafana in labs


What is an SLI?
A Service Level Indicator (SLI) is a quantitative measure of a specific aspect of a service’s performance, such as availability, latency, or error rate.

SLIs are used alongside Service Level Objectives (SLOs) and Service Level Agreements (SLAs) to define and maintain service reliability.

By setting clear performance metrics, SLIs provide measurable insights that help monitor, assess, and improve the overall reliability of a service.


# Quests

- Valid SLI Metrics
- Which of the following metrics is considered a valid SLI?
 ### Options
 ```
    Error Rate(Answer)
    Memory Usage
    Cpu Usage 
    Disk IO
 ```

- Latency as an SLI
What does latency primarily measure as an SLI?
### Options
```
Time taken to respond to a request
```

- Infrastructure vs User-Focused Metrics
  Why is CPU usage not considered a good SLI?

  ```
    It does not directly correlate with user experience
  ```

Implementing SLIS with Prometheus
- Sum Function for SLI Formulation
A sum function (typically a counter) accumulates a total count over time and is commonly used for tracking HTTP responses or event occurrences.

-> How It Works:
Increments by 1 for each successful request or event.

-> Use Cases:

Availability monitoring
Traffic analysis
Alerting
-> Key Example:

sum(rate(http_requests_total{status="200", endpoint="/health"}[5m]))

This query calculates the rate of successful /health endpoint requests over the last 5 minutes, helping monitor service reliability.



Histogram Metric for SLI Formulation
A histogram is a metric type that tracks the distribution of values over time, particularly useful for measuring metrics such as request durations, sizes, or latency.

-> How it Works:

Histograms track how many observations fall into predefined buckets (e.g., 0.1, 0.5, 1, 5 seconds).

It helps visualize the distribution of request durations, showing not just averages but how requests are distributed across various time ranges.

-> Use Cases:

Latency analysis
Heatmap creation
Visualizing distribution patterns
->Key Example:

histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{le="0.5"}[5m]))

This query calculates the 95th percentile request duration over the last 5 minutes.

-> Explanation of the le="0.5" Label:

The le label (less than or equal to) specifies the upper bound for each bucket.

In this case, le="0.5" filters for the bucket containing requests that took 0.5 seconds (500ms) or less to complete.

-> Example Interpretation:

If the query result is 0.3 seconds, it means 95% of requests were completed in 0.3 seconds or less, and these requests fall within the 500ms bucket.






Availability Expressed in Nines
Availability is often measured in "nines". For example, 99.999% uptime (five nines) translates to approximately 5 minutes of downtime per year.

The "nines" notation is a standard way to express service availability, helping teams set and communicate reliability targets effectively across technical and business stakeholders.



############# 
The KodeKloud Record Store Application
Follow these step-by-step setup instructions to initiate The KodeKloud Record Store Application:

1. Set Up Environment Variables

cd /root/kodekloud-records-store-web-app-main

# Run the environment setup script (creates .env.dev with safe defaults)
./deploy/environments/setup-local-env.sh

# Verify the environment file was created
cat /root/kodekloud-records-store-web-app-main/deploy/environments/.env.dev

The setup script creates a .env.dev file with these defaults:

Grafana: admin / dev_admin_123

Database: dev_user / dev_password_123

Service name: kodekloud-record-store-api-dev

2. Start the Complete Stack

# Start all services (application + observability)
docker-compose --env-file deploy/environments/.env.dev up -d

# Check all services are running
docker-compose ps

3. Verify Everything is Working
You can access it at Port 8000 and test its endpoints using the following commands:

# Test the API
curl http://localhost:8000/

# Check metrics endpoint
curl http://localhost:8000/metrics

# Check health
curl http://localhost:8000/health

In later lessons, we'll explore how the monitoring stack integrates with this application. For now, we'll focus on examining the SLI rules configured in this lab environment.


Note:
If you see warnings such as:
The "POSTGRES_HOST" variable is not set. Defaulting to a blank string.
it means Docker Compose didn’t load your environment variables correctly.

Fix:
Navigate to the project directory and reload the environment variables before re-running Docker Compose:

cd /root/kodekloud-records-store-web-app-main
set -a ; source deploy/environments/.env.dev ; set +a
docker-compose ps

This ensures all environment variables from .env.dev are properly exported and recognized by Docker Compose.

###########

Explore the Service Level Indicators (SLIs) defined for the application.

Run the following command in your terminal:

cat /root/kodekloud-records-store-web-app-main/config/monitoring/sli_rules.yml

SLIs Defined in the File:

Throughput – Measures the number of successful requests per second
Error Rate – Tracks the percentage of failed requests
Availability – Defines uptime based on successful health checks
Latency – Monitors response time performance
These SLIs help in evaluating the service's performance, reliability, and user experience.



####################

Access and analyze the SLI dashboards in Grafana to monitor service performance.

Steps to View the Dashboard:
Step 1: Open Grafana

Grafana is running on Port 3000.
Click the Grafana button in the top panel to access it.
Step 2: Log in to Grafana

Username: admin
Password: dev_admin_123
Step 3: Navigate to the SLI Dashboard

Click on Dashboards from the left panel.
Select "KodeKloud Records Store SLIs Dashboard" to view key performance metrics.