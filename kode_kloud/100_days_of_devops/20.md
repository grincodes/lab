# Quests
The Nautilus application development team is planning to launch a new PHP-based application, which they want to deploy on Nautilus infra in Stratos DC. The development team had a meeting with the production support team and they have shared some requirements regarding the infrastructure. Below are the requirements they shared:

a. Install nginx on app server 3 , configure it to use port 8098 and its document root should be /var/www/html.
b. Install php-fpm version 8.3 on app server 3, it must use the unix socket /var/run/php-fpm/default.sock (create the parent directories if don't exist).
c. Configure php-fpm and nginx to work together.
d. Once configured correctly, you can test the website using curl http://stapp03:8098/index.php command from jump host.

NOTE: We have copied two files, index.php and info.php, under /var/www/html as part of the PHP-based application setup. Please do not modify these files.

# Process and Solutions
- ssh into app server 3
    ```
        ssh user@host
    ```

- install nginx
    ```
        sudo yum install -y nginx
    ```
- on nginx.conf and configure nginx to listen on port 8098 
    ```
        sudo vi /etc/nginx/nginx.conf
    ```

    ```
        ...
        server {
            listen 8098
            listen [::]8098
        }
        ...
    ```
- install php-fpm
    ```
        sudo dnf install epel-release -y
        sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-9.rpm -y
        sudo dnf module list php
        sudo dnf module enable php:remi-8.1 -y
        sudo dnf install php-fpm php php-cli php-common php-mysqlnd php-gd php-xml php-mbstring php-pdo php-opcache -y
    ```

- start php-fpm

    ```
        sudo systemctl start php-fpm
        sudo systemctl enable php-fpm
        sudo systemctl status php-fpm
    ```

- confirm php version

    ```
      php -v
    ```
-  create directory for php-fpm sock
    ```
        sudo mkdir -p /var/run/php-fpm
    ```

-  Edit the pool configuration file 
    ```
        sudo vi /etc/php-fpm.d/www.conf
    ```
    Find the listen directive and change it to:
    ```
        listen = /var/run/php-fpm/default.sock
    ```
    Uncomment or set the following to ensure Nginx has permission to use the socket:
    
    ```
        listen.owner = nginx
        listen.group = nginx
        listen.mode = 0660
    ```
    

- restart the service
    ```
        sudo systemctl restart php-fpm
    ```

- configure php to work with nginx

    ```
        sudo vi /etc/nginx/nginx.conf
    ```

    add  this to the server block
    ```
    server{
        location ~ \.php$ {
                include fastcgi_params;
                fastcgi_pass unix:/var/run/php-fpm/default.sock;
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
         }
    }
    ```

- reload nginx 
   
   ```
        sudo nginx -t
        sudo systemctl restart nginx

   ```
- test and curl from jump host
    ```
        curl http://stapp03:8098/index.php
    ```


